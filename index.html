<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>수학 방탈출</title>
    <style>
        /* 모든 요소에 박스 사이징과 마진, 패딩 초기화 */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            min-height: 100vh;
            position: relative; /* 백 버튼을 위한 위치 설정 */
        }

        .header {
            color: white;
            padding: 20px;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            background: linear-gradient(
                45deg,
                #ff0000,
                #ff7f00,
                #ffff00,
                #00ff00,
                #0000ff,
                #4b0082,
                #8b00ff
            );
            background-size: 700% 700%;
            animation: rainbow 8s linear infinite;
            position: relative;
        }

        @keyframes rainbow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-top: 20px;
            margin-bottom: 80px; /* 푸터 공간 확보 */
        }

        .hint-count {
            background: white;
            border-radius: 8px;
            padding: 10px;
            margin: 10px 0;
            text-align: center;
            font-size: 16px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .back-button {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.3);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            font-size: 20px;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s ease;
            z-index: 1; /* 버튼이 다른 요소 위에 표시되도록 설정 */
        }

        .back-button:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        .input-box {
            background: white;
            border: 2px solid #ccc;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            text-align: center;
            font-size: 20px;
            cursor: pointer;
            min-height: 60px;
            transition: border-color 0.3s ease;
        }

        .input-box:hover {
            border-color: #4a90e2;
        }

        .button {
            background: #4a90e2;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 15px;
            width: 100%;
            font-size: 18px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .button:hover {
            background: #357abd;
        }

        .button:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }

        .keypad {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 20px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            display: none;
            animation: slideUp 0.3s ease;
            z-index: 2; /* 키패드가 다른 요소 위에 표시되도록 설정 */
        }

        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }

        .keypad-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-bottom: 10px;
        }

        .keypad-grid.numbers {
            grid-template-columns: repeat(5, 1fr);
        }

        .keypad-button {
            background: #f0f0f0;
            border: none;
            border-radius: 4px;
            padding: 15px;
            font-size: 18px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .keypad-button:active {
            background: #e0e0e0;
            transform: scale(0.95);
        }

        .hint-text {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            font-size: 18px;
            line-height: 1.5;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            white-space: pre-line; /* 줄바꿈 유지 */
        }

        .answer-section {
            text-align: center;
            margin-top: 30px;
        }

        .answer-button {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            width: 100%;
            color: #4a90e2;
            transition: color 0.3s ease;
            position: relative;
        }

        .answer-button:hover {
            color: #357abd;
        }

        .answer-line {
            width: 100%;
            height: 2px;
            background: #ccc;
            margin-top: 10px;
            transition: background-color 0.3s ease;
            position: absolute;
            bottom: 0;
            left: 0;
        }

        .answer-button:hover .answer-line {
            background: #4a90e2;
        }

        .answer-box {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            display: none;
            font-size: 18px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            animation: fadeIn 0.3s ease;
            white-space: pre-line; /* 줄바꿈 유지 */
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .backspace {
            background: #ff9999;
            color: white;
        }

        .clear {
            background: #ff4444;
            color: white;
        }

        .backspace:hover, .clear:hover {
            filter: brightness(0.9);
        }

        footer {
            background-color: #333;
            color: #fff;
            text-align: center;
            padding: 10px;
            position: fixed;
            bottom: 0;
            width: 100%;
        }
    </style>
</head>
<body>
    <div class="header">
        <button class="back-button" id="backButton">←</button>
        수학방탈출
    </div>
    
    <div class="container" id="codeScreen">
        <div class="hint-count" id="hintCount">남은 힌트 횟수: 3회</div>
        <div class="input-box" id="codeInput">힌트 코드를 입력하세요</div>
        <button class="button" id="submitCode">완료</button>
    </div>

    <div class="container" id="hintScreen" style="display: none;">
        <div class="hint-text" id="hintText">
            힌트 내용이 여기에 표시됩니다.
        </div>
        <div class="answer-section">
            <button class="answer-button" id="showAnswer">
                정답확인
                <div class="answer-line"></div>
            </button>
            <div class="answer-box" id="answerBox"></div>
        </div>
        <button class="button" id="backToCode" style="margin-top: 20px;">다른 코드 입력하기</button>
    </div>

    <div class="keypad" id="keypad">
        <div class="keypad-grid numbers" id="numberPad">
        </div>
        <div class="keypad-grid" id="letterPad">
        </div>
    </div>

    <footer>
        <p>저작권 © 2024 - 나의 웹 페이지</p>
    </footer>

    <script>
        // 필요한 요소들 가져오기
        const codeScreen = document.getElementById('codeScreen');
        const hintScreen = document.getElementById('hintScreen');
        const codeInput = document.getElementById('codeInput');
        const keypad = document.getElementById('keypad');
        const numberPad = document.getElementById('numberPad');
        const letterPad = document.getElementById('letterPad');
        const submitCode = document.getElementById('submitCode');
        const showAnswer = document.getElementById('showAnswer');
        const answerBox = document.getElementById('answerBox');
        const hintText = document.getElementById('hintText');
        const backToCode = document.getElementById('backToCode');
        const backButton = document.getElementById('backButton');
        const hintCountDisplay = document.getElementById('hintCount');

        // 힌트 사용 횟수 관리 (localStorage 사용)
        let hintCount = localStorage.getItem('hintCount') ? parseInt(localStorage.getItem('hintCount')) : 3;

        // 현재 입력된 코드
        let currentCode = '';

        // 숫자와 코드 간의 매핑
        const numberToCode = {
            '2': 'aG7B',
            '12': 'a4K9',
            '7': 'aM2Q',
            '5': 'a8Z3',
            '6': 'aR1X',
            '4': 'aT6J',
            '8': 'a3P8',
            '9': 'aY4S',
            '10': 'aC2M',
            '13': 'aZ4T',
            '14': 'a6B9',
            '15': 'aK2M',
            '16': 'a7L3'
        };

        // 힌트 코드와 해당하는 힌트/정답 또는 페이지
        const hints = {
            'a00': {
                type: 'page',
                url: 'a00.html'
            },
            'a01': {
                type: 'page',
                url: 'a01.html'
            },
            // 추가 힌트 코드
            'aL5D': {
                type: 'hint',
                hint: '이것은 추가 힌트입니다.',
                answer: '추가 정답입니다.'
            },
            'aN9V': {
                type: 'hint',
                hint: '이것은 또 다른 힌트입니다.',
                answer: '또 다른 정답입니다.'
            },
            'a7W5': {
                type: 'hint',
                hint: '더 많은 힌트가 필요하신가요?',
                answer: '더 많은 정답입니다.'
            },
            'aQ8L': {
                type: 'hint',
                hint: '힌트는 여기에 있습니다.',
                answer: '힌트에 대한 정답입니다.'
            },
            'aD3K': {
                type: 'hint',
                hint: '이 힌트는 매우 중요합니다.',
                answer: '중요한 정답입니다.'
            },
            'aS6F': {
                type: 'hint',
                hint: '마지막 힌트를 확인하세요.',
                answer: '마지막 정답입니다.'
            },
            // master 코드 추가
            'master': {
                type: 'reset',
                message: '힌트 카운트가 3회로 초기화되었습니다.'
            }
        };

        // 뒤로가기 버튼 클릭 시
        backButton.onclick = () => {
            const confirmExit = confirm('목록으로 돌아가시겠습니까?');
            if (confirmExit) {
                window.location.href = 'index.html'; // 'index.html'로 수정
            }
        };

        // 힌트 카운트 업데이트
        function updateHintCount() {
            hintCountDisplay.textContent = `남은 힌트 횟수: ${hintCount}회`;
            // localStorage에 힌트 카운트 저장
            localStorage.setItem('hintCount', hintCount);
            console.log(`힌트 카운트 업데이트: ${hintCount}`);
        }

        // 숫자 키패드 생성
        for (let i = 1; i <= 9; i++) {
            const button = document.createElement('button');
            button.className = 'keypad-button';
            button.textContent = i;
            button.onclick = () => addToCode(i.toString());
            numberPad.appendChild(button);
        }
        
        const button0 = document.createElement('button');
        button0.className = 'keypad-button';
        button0.textContent = '0';
        button0.onclick = () => addToCode('0');
        numberPad.appendChild(button0);

        // 백스페이스 버튼 추가
        const backspace = document.createElement('button');
        backspace.className = 'keypad-button backspace';
        backspace.textContent = '←';
        backspace.onclick = () => {
            currentCode = currentCode.slice(0, -1);
            updateDisplay();
        };
        numberPad.appendChild(backspace);

        // 알파벳 키패드 생성
        'abcdefghijklmnopqrstuvwxyz'.split('').forEach(letter => {
            const button = document.createElement('button');
            button.className = 'keypad-button';
            button.textContent = letter;
            button.onclick = () => addToCode(letter);
            letterPad.appendChild(button);
        });

        // 코드 입력창 클릭 시 키패드 표시
        codeInput.onclick = (e) => {
            e.stopPropagation(); // 이벤트 버블링 방지
            keypad.style.display = 'block';
        };

        // 화면 클릭 시 키패드 숨기기 (입력창 제외)
        document.addEventListener('click', (e) => {
            if (!keypad.contains(e.target) && e.target !== codeInput) {
                keypad.style.display = 'none';
            }
        });

        // 코드에 문자 추가
        function addToCode(char) {
            if (currentCode.length < 10) { // 코드 길이를 10으로 확장 (master는 6자)
                currentCode += char;
                updateDisplay();
            }
        }

        // 디스플레이 업데이트
        function updateDisplay() {
            codeInput.textContent = currentCode || '힌트 코드를 입력하세요';
        }

        // 완료 버튼 클릭 시
        submitCode.onclick = () => {
            if (currentCode.trim() === '') {
                alert('코드를 입력해주세요!');
                return;
            }

            // 입력된 코드가 숫자인지 확인
            if (!isNaN(currentCode)) {
                const codeNumber = currentCode.trim();
                const mappedCode = numberToCode[codeNumber];
                if (mappedCode) {
                    // 숫자에 매핑된 코드가 있을 경우 해당 페이지로 이동
                    window.location.href = `${mappedCode}.html`;
                } else {
                    alert('입력한 숫자에 해당하는 코드가 없습니다!');
                }
            } else {
                // 입력된 코드가 숫자가 아닌 경우 기존 힌트 코드 처리
                const entry = hints[currentCode];
                if (entry) {
                    if (entry.type === 'reset') {
                        hintCount = 3; // 힌트 횟수를 3으로 초기화
                        updateHintCount();
                        alert(entry.message);
                        currentCode = '';
                        updateDisplay();
                    } else {
                        if (entry.type === 'page') {
                            if (hintCount > 0) {
                                hintCount--;
                                updateHintCount();
                                window.location.href = entry.url;
                            } else {
                                alert('힌트 사용 횟수를 모두 소진하였습니다!');
                            }
                        } else if (entry.type === 'hint') {
                            if (hintCount > 0) {
                                hintCount--;
                                updateHintCount();
                                codeScreen.style.display = 'none';
                                hintScreen.style.display = 'block';
                                keypad.style.display = 'none';
                                hintText.textContent = entry.hint;
                                answerBox.textContent = entry.answer;
                                answerBox.style.display = 'none';
                            } else {
                                alert('힌트 사용 횟수를 모두 소진하였습니다!');
                            }
                        }
                    }
                } else {
                    alert('올바른 힌트 코드를 입력해주세요!');
                }
            }
            // 코드 초기화
            currentCode = '';
            updateDisplay();
        };

        // 정답 확인 버튼 클릭 시
        showAnswer.onclick = () => {
            answerBox.style.display = answerBox.style.display === 'none' ? 'block' : 'none';
        };

        // 다른 코드 입력하기 버튼 클릭 시
        backToCode.onclick = () => {
            currentCode = '';
            updateDisplay();
            hintScreen.style.display = 'none';
            codeScreen.style.display = 'block';
        };

        // 초기 힌트 카운트 표시
        updateHintCount();
    </script>
</body>
</html>
